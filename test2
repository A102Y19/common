def wait_for_schema_popup():
    print("⌛ Waiting for schema execution popup...")

    while True:
        found_installer = False
        try:
            windows = Desktop(backend="uia").windows()
            for w in windows:
                try:
                    # Get all text controls
                    all_texts = []
                    for ctrl in w.descendants(control_type="Text"):
                        txt = ctrl.window_text()
                        if txt.strip():
                            all_texts.append(txt.strip())

                    combined_text = " ".join(all_texts).lower()

                    if "update installer" in combined_text:
                        found_installer = True

                        # Ignore running popups
                        if "in progress" in combined_text or "still running" in combined_text:
                            continue

                        # Handle success popup
                        if "successfully executed" in combined_text:
                            print("✅ Schema executed successfully.")
                            try:
                                w.child_window(title="OK", control_type="Button").click_input()
                            except:
                                print("⚠️ OK button not found.")
                            return True

                        # Handle error popup
                        elif "encountered an error" in combined_text:
                            print("❌ Schema execution failed.")
                            try:
                                w.child_window(title="OK", control_type="Button").click_input()
                            except:
                                print("⚠️ OK button not found.")
                            return False

                        else:
                            print("⚠️ Unknown installer popup content.")
                            try:
                                w.child_window(title="OK", control_type="Button").click_input()
                            except:
                                print("⚠️ OK button not found.")
                            return None

                except Exception:
                    continue

        except Exception as e:
            print("Error scanning windows:", e)

        if found_installer:
            print("⏳ Update Installer still running...waiting.")
        else:
            print("⌛ Waiting for schema execution popup...")

        time.sleep(2)
