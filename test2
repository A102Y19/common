def wait_for_schema_popup():
    print("üîç Waiting for schema execution popup...")

    while True:
        try:
            windows = Desktop(backend="uia").windows()
            for w in windows:
                try:
                    all_texts = []
                    for ctrl in w.descendants(control_type="Text"):
                        txt = ctrl.window_text()
                        if txt.strip():
                            all_texts.append(txt.strip())

                    combined_text = " ".join(all_texts).lower()

                    if "update installer" in combined_text:
                        # Check if it's still running - skip and wait
                        if "in progress" in combined_text:
                            print("‚è≥ Update Installer still running... waiting.")
                            continue

                        # Handle success
                        if "successfully executed" in combined_text:
                            print(f"\n‚úÖ Success popup: {w.window_text()}")
                            print("üìã Text:", combined_text)
                            try:
                                w.child_window(title="OK", control_type="Button").click_input()
                                print("‚úÖ Clicked OK.")
                            except:
                                print("‚ö†Ô∏è OK button not found.")
                            print("‚úÖ Schema executed successfully.")
                            return True

                        # Handle error
                        elif "encountered an error" in combined_text or "error and will exit" in combined_text:
                            print(f"\n‚ùå Error popup: {w.window_text()}")
                            print("üìã Text:", combined_text)
                            try:
                                w.child_window(title="OK", control_type="Button").click_input()
                                print("‚úÖ Clicked OK.")
                            except:
                                print("‚ö†Ô∏è OK button not found.")
                            print("‚ùå Schema execution failed.")
                            return False

                        # Unknown result
                        else:
                            print(f"\n‚ùì Unknown popup: {w.window_text()}")
                            print("üìã Text:", combined_text)
                            try:
                                w.child_window(title="OK", control_type="Button").click_input()
                                print("‚úÖ Clicked OK.")
                            except:
                                print("‚ö†Ô∏è OK button not found.")
                            print("Schema execution STATUS UNKNOWN ‚ö†Ô∏è")
                            return None

                except Exception:
                    continue

        except Exception as e:
            print("Error reading windows:", e)

        time.sleep(2)
