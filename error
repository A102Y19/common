from pywinauto import Desktop
import time

def wait_for_update_installer_and_information():
    print("üîç Searching inside OMP for 'Update Installer'...")

    # First find OMP main window
    omp_window = None
    while omp_window is None:
        try:
            windows = Desktop(backend="uia").windows()
            for win in windows:
                if "OMP Data Change Manager" in win.window_text():
                    omp_window = win
                    print("‚úÖ OMP Main window found.")
                    break
        except Exception as e:
            print(f"Error finding main window: {e}")
        time.sleep(5)

    # Step 1: Wait for Update Installer pane
    while True:
        try:
            all_panes = omp_window.descendants(control_type="Pane")
            for pane in all_panes:
                pane_name = pane.window_text()
                if "Update Installer" in pane_name:
                    print(f"‚úÖ Found 'Update Installer' pane: {pane_name}")
                    break
            else:
                time.sleep(10)
                continue
            break  # Exit loop once Update Installer is found
        except Exception as e:
            print(f"Error checking panes: {e}")
            time.sleep(5)

    # Step 2: Wait for Information pane
    print("üïí Waiting for 'Information' pane every 60 seconds...")
    while True:
        try:
            all_panes = omp_window.descendants(control_type="Pane")
            for pane in all_panes:
                if "Information" in pane.window_text():
                    print(f"‚úÖ Found 'Information' pane: {pane.window_text()}")

                    # Try reading the message
                    try:
                        text_elem = pane.child_window(control_type="Text")
                        print(f"üí¨ Message: {text_elem.window_text()}")
                    except:
                        print("‚ö†Ô∏è Couldn't read text.")

                    # Try clicking OK
                    try:
                        ok_button = pane.child_window(title="OK", control_type="Button")
                        ok_button.click()
                        print("‚úÖ Clicked OK.")
                    except:
                        print("‚ö†Ô∏è Couldn't click OK.")
                    return
        except Exception as e:
            print(f"Error during Information pane check: {e}")

        time.sleep(60)
