from pywinauto import Desktop
import time

def handle_notepad_if_opened(timeout=60):
    print("ğŸ” Checking if Notepad is open after ENTER...")
    notepad_window = None
    start_time = time.time()

    while notepad_window is None and (time.time() - start_time < timeout):
        try:
            windows = Desktop(backend="uia").windows()
            for win in windows:
                if "Notepad" in win.window_text():
                    print("âœ… Notepad window found.")
                    notepad_window = win
                    break
        except Exception as e:
            print(f"Error finding Notepad: {e}")
        time.sleep(3)

    if notepad_window is None:
        print("âœ… No Notepad opened.")
        return

    try:
        print("ğŸ” Searching for Edit control...")
        edit_controls = notepad_window.descendants(control_type="Edit")
        if not edit_controls:
            print("âŒ Could not find Edit box in Notepad.")
            return

        text = edit_controls[0].window_text()
        lines = text.strip().splitlines()

        error_lines = [line for line in lines if "error" in line.lower()]
        if error_lines:
            print("ğŸ›‘ Error lines found in Notepad:")
            for line in error_lines:
                print(f"> {line}")
        else:
            print("âœ… No error lines found in Notepad.")

        notepad_window.close()
        print("âœ… Closed Notepad.")
    except Exception as e:
        print(f"âŒ Error reading or closing Notepad: {e}")
