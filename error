from pywinauto import Desktop
import time

def wait_for_schema_popup():
    print("üîç Waiting for schema execution popup...")

    while True:
        try:
            windows = Desktop(backend="uia").windows()
            for w in windows:
                try:
                    all_texts = []
                    for ctrl in w.descendants(control_type="Text"):
                        txt = ctrl.window_text()
                        if txt.strip():
                            all_texts.append(txt.strip())

                    combined_text = " ".join(all_texts).lower()

                    if "update installer" in combined_text or "successfully executed" in combined_text or "encountered an error" in combined_text:
                        print(f"\n‚úÖ Popup detected in window: {w.window_text()}")
                        print("üìã Popup Text:", combined_text)

                        try:
                            w.child_window(title="OK", control_type="Button").click_input()
                            print("‚úÖ Clicked OK button.")
                        except:
                            print("‚ö†Ô∏è OK button not found.")

                        if "successfully executed" in combined_text:
                            print("‚úÖ Schema executed successfully.")
                            return True
                        elif "encountered an error" in combined_text:
                            print("‚ùå Schema execution failed.")
                            return False
                        else:
                            print("‚ùì Unknown result.")
                            return None

                except:
                    continue

        except Exception as e:
            print("Error reading windows:", e)

        time.sleep(2)



result = wait_for_schema_popup()

if result == True:
    print("Schema execution SUCCESS ‚úÖ")
elif result == False:
    print("Schema execution FAILED ‚ùå")
else:
    print("Schema execution STATUS UNKNOWN ‚ö†Ô∏è")
