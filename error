def stop_dispatcher(omp_app, dispatcher_path):
    try:
        omp_window = omp_app.top_window()
        omp_window.set_focus()
        time.sleep(1)

        logging.info("Sending Alt + U...")
        omp_window.type_keys('%u')
        time.sleep(1)
        logging.info("Sending W...")
        omp_window.type_keys('W')
        time.sleep(1)
        logging.info("Sending C...")
        omp_window.type_keys('C')
        time.sleep(1)
        logging.info("Sending C...")
        omp_window.type_keys('C')
        time.sleep(1)
        logging.info("Sending ENTER...")
        send_keys("{ENTER}")
        time.sleep(10)

        # Check if CMD opened
        logging.info("Checking for CMD window...")
        cmd_found = False
        for _ in range(5):
            try:
                windows = findwindows.find_windows(title_re=".*Command Prompt.*", backend='win32')
                if windows:
                    logging.info("Command Prompt window found.")
                    cmd_found = True
                    break
            except Exception:
                pass
            time.sleep(5)

        if not cmd_found:
            logging.error("Command Prompt window not found after stop dispatcher.")
            return

        # Send pushd <dispatcher_path> and execute stop command
        logging.info(f"Sending pushd command to path: {dispatcher_path}")
        send_keys(f'pushd {dispatcher_path}')
        send_keys('{ENTER}')
        time.sleep(2)
        logging.info("Sending stop command...")
        send_keys('DispatcherManagementAction.cmd stop /all')
        send_keys('{ENTER}')
        logging.info("Dispatcher stop command sent.")

    except Exception as e:
        logging.error(f"Error in stop_dispatcher: {e}")




elif "stop dispatcher" in action:
    print("Executing stop dispatcher")
    if omp_app:
        dispatcher_path = str(row.iloc[2]).strip()
        stop_dispatcher(omp_app, dispatcher_path)
