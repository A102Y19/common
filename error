import os
from datetime import datetime

def handle_notepad_errors_from_opened_window(timeout=60, save_file=True):
    print("🔍 Checking if Notepad is open after ENTER...")
    notepad_window = None
    start_time = time.time()

    while notepad_window is None and (time.time() - start_time < timeout):
        try:
            windows = Desktop(backend="win32").windows()
            for win in windows:
                if "Notepad" in win.window_text():
                    print("✅ Notepad window found.")
                    notepad_window = win
                    break
        except Exception as e:
            print(f"Error finding Notepad: {e}")
        time.sleep(3)

    if notepad_window is None:
        print("❌ Notepad not found.")
        return

    try:
        notepad_window.set_focus()

        if save_file:
            # Prepare log path and filename
            timestamp = datetime.now().strftime('%Y-%m-%d_%H-%M-%S')
            folder_path = r'C:\log'
            os.makedirs(folder_path, exist_ok=True)  # Ensure folder exists
            full_path = os.path.join(folder_path, f'Failed_Logs_{timestamp}.txt')

            print(f"💾 Saving Notepad file to: {full_path}")
            pyautogui.hotkey('ctrl', 's')  # Open Save As dialog
            time.sleep(1)
            pyautogui.write(full_path)  # Type the full path
            pyautogui.press('enter')
            time.sleep(2)

        notepad_window.close()
        print("✅ Closed Notepad.")
    except Exception as e:
        print(f"❌ Error handling Notepad: {e}")
