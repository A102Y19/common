from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.common.action_chains import ActionChains

def download_pak_file(driver, file_name):
    try:
        print(f"üîç Searching for PAK file: {file_name}...")

        # Construct XPath dynamically using file name
        file_xpath = f"//div[contains(@class, 'file-list-item') and contains(text(), '{file_name}')]"
        print(f"üìù Generated XPath: {file_xpath}")

        # Wait until the file element appears
        file_element = WebDriverWait(driver, 20).until(
            EC.presence_of_element_located((By.XPATH, file_xpath))
        )
        
        print(f"‚úÖ File '{file_name}' found!")

        # Check if the element has the required class
        file_class = file_element.get_attribute("class")
        print(f"üìå File class: {file_class}")

        if "file-list-item--selected" not in file_class:
            print("üîπ File is not selected, clicking to select it...")
            file_element.click()
            time.sleep(2)  # Allow selection time

        # Click the download button (assumed to exist)
        download_button_xpath = "//button[contains(@class, 'download-button-class')]"  # Update actual class
        download_button = WebDriverWait(driver, 10).until(
            EC.element_to_be_clickable((By.XPATH, download_button_xpath))
        )

        print("‚¨á Clicking Download Button...")
        download_button.click()
        print("‚úÖ Download initiated!")

    except Exception as e:
        print(f"‚ùå ERROR: Could not download file '{file_name}'. Details: {e}")
