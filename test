from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC
from selenium.webdriver.common.action_chains import ActionChains
import time

def download_pak_file(driver, file_name):
    try:
        print(f"üîç Searching for PAK file: {file_name}...")

        # Locate the file element
        file_xpath = f"//div[contains(@class, 'file-list-item') and .//*[contains(text(), '{file_name}')]]"
        file_element = WebDriverWait(driver, 20).until(
            EC.presence_of_element_located((By.XPATH, file_xpath))
        )

        print(f"‚úÖ File '{file_name}' found and selected!")

        # Perform a right-click (context menu)
        actions = ActionChains(driver)
        actions.context_click(file_element).perform()
        print("üñ±Ô∏è Right-clicked on the file!")

        time.sleep(1)  # Wait for the context menu to appear

        # Select the second option in the context menu (Download)
        download_option_xpath = "//div[contains(@class, 'context-menu-item')][2]"  # Adjust based on actual HTML
        download_option = WebDriverWait(driver, 5).until(
            EC.element_to_be_clickable((By.XPATH, download_option_xpath))
        )

        download_option.click()
        print("‚úÖ Download triggered successfully!")

    except Exception as e:
        print(f"‚ùå ERROR: Could not download file '{file_name}'. Details: {e}")
