from pywinauto import Desktop
import pytesseract
from PIL import ImageGrab
import time

def read_info_popup_via_ocr():
    print("üîç Looking for 'Information' popup inside OMP...")

    # Step 1: Find the OMP window and the Information pane
    omp_window = None
    while not omp_window:
        for w in Desktop(backend="uia").windows():
            if "OMP Data Change Manager" in w.window_text():
                omp_window = w
                break
        time.sleep(1)

    info_pane = None
    while not info_pane:
        for pane in omp_window.descendants(control_type="Pane"):
            if "Information" in pane.window_text():
                info_pane = pane
                print(f"‚úÖ Found 'Information' pane: {pane.window_text()}")
                break
        time.sleep(1)

    # Step 2: Get the rectangle of the Information pane
    rect = info_pane.rectangle()
    print(f"üì∏ Capturing region: {rect}")

    # Step 3: Screenshot that region
    image = ImageGrab.grab(bbox=(rect.left, rect.top, rect.right, rect.bottom))
    image.save("info_popup.png")  # Optional: for debugging

    # Step 4: Run OCR
    text = pytesseract.image_to_string(image)
    print("üßæ OCR Output:\n" + text)

    # Step 5: Classify
    lower_text = text.lower()
    if "success" in lower_text or "successfully" in lower_text:
        print("‚úÖ SUCCESS detected in popup.")
    elif "fail" in lower_text or "error" in lower_text:
        print("‚ùå ERROR detected in popup.")
    else:
        print("‚ö†Ô∏è Could not classify the popup content.")

