#$pwd = Read-Host -AsSecureString
#$bstr = [System.Runtime.InteropServices.Marshal]::SecureStringToBSTR($pwd)
#$value = [System.Runtime.InteropServices.Marshal]::PtrToStringAuto($bstr)
#Read encryot File
$secure = Get-Content "\\awsusdmkfsxn01.jnj.com\mdd_tst_omp\OMP_JNJ_MD_ATOM_LAB\OMPartners\development\bin\pw.txt" | ConvertTo-SecureString
$plain = [System.Runtime.InteropServices.Marshal]::PtrToStringAuto(
    [System.Runtime.InteropServices.Marshal]::SecureStringToBSTR($secure)
)

schtasks.exe /run /S "AWSDMKNVAW0001" /U "JNJ\SA-ITS-APSMDINT-LAB" /P $plain /tn "OMPDispatcher\OMP_JNJ_MD_ATOM_LAB"
Start-Sleep -Seconds 20
#schtasks.exe /run /S "AWSDMKNVAW0002" /U "JNJ\SA-ITS-APSMDINT-LAB" /P $plain /tn "OMPDispatcher\OMP_JNJ_MD_ATOM_LAB_DSPAgent"
schtasks.exe /run /S "AWSDMKNVAW000E" /U "JNJ\SA-ITS-APSMDINT-LAB" /P $plain /tn "OMPDispatcher\OMP_JNJ_MD_ATOM_LAB_DSPAgent"
schtasks.exe /run /S "AWSDMKNVAW000F" /U "JNJ\SA-ITS-APSMDINT-LAB" /P $plain /tn "OMPDispatcher\OMP_JNJ_MD_ATOM_LAB_DSPAgent"
schtasks.exe /run /S "AWSDMKNVAW000G" /U "JNJ\SA-ITS-APSMDINT-LAB" /P $plain /tn "OMPDispatcher\OMP_JNJ_MD_ATOM_LAB_DSPAgent"

Start-Sleep -Seconds 30
  $url = "http://awsdmknvaw0001:8085/OMPDispatcher?wsdl"
      $time = try{ 
      $request = $null 
       ## Request the URI, and measure how long the response took. 
      $result1 = Measure-Command { $request = Invoke-WebRequest -Uri $url } 
      $result1.TotalMilliseconds 
      }  
  
      catch 
      { 
       <# If the request generated an exception (i.e.: 500 server error or 404 not found), we can pull the status code from the 
       Exception.Response property #> 
       $request = $_.Exception.Response 
       $time = -1 
      }   
      $result = [Array]$result + [PSCustomObject] @{ 
      Time = Get-Date; 
      Uri = $url; 
      StatusCode = [int] $request.StatusCode; 
      StatusDescription = $request.StatusDescription; 
      ResponseLength = $request.RawContentLength; 
      TimeTaken =  $time;  
      } 
      $result
      Clear-Variable result
