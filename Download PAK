import subprocess
import socket
import getpass
import logging

logging.basicConfig(level=logging.INFO)

servers = {
    "AWSDMJNVAW0001": r"OMPDISPATCHER\OMP_JNJ_MD_OMEGA_LAB",
    "AWSDMJNVAW0002": r"OMP Dispatcher\OMP_JNJ_MD_OMEGA_LAB_DSPAgent",
    "AWSDMJNVAW000D": r"OMP Dispatcher\OMP_JNJ_MD_OMEGA_LAB_DSPAgent",
    "AWSDMJNVAW000E": r"OMP Dispatcher\OMP_JNJ_MD_OMEGA_LAB_DSPAgent",
    "AWSDMJNVAW000H": r"OMPDispatcher\OMP_JNJ_MD_OMEGA_LAB_DSPAgent",
    "AWSDMJNVAW000M": r"OMPDispatcher\OMP_JNJ_MD_OMEGA_LAB_DSPAgent"
}

username = "SA-ITS-APSOMINT-LAB"
password = getpass.getpass("Enter password for scheduled tasks: ")

current_host = socket.gethostname().upper()
logging.info(f"Current host is {current_host}")

for server, task in servers.items():
    if current_host == server:
        cmd = ["schtasks.exe", "/run", "/tn", task]
    else:
        cmd = ["schtasks.exe", "/run", "/S", server, "/U", username, "/P", password, "/tn", task]

    logging.info(f"Executing: {' '.join(cmd)}")
    result = subprocess.run(cmd, capture_output=True, text=True)
    print(result.stdout)
    if result.stderr:
        print(f"Error: {result.stderr}")
